(this.webpackJsonpmeet=this.webpackJsonpmeet||[]).push([[0],{29:function(e,n,t){e.exports=t(45)},34:function(e,n,t){},42:function(e,n,t){},45:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(9),o=t.n(c),l=(t(34),t(2)),s=t(24),i=t(5),u=t.n(i),d=t(7),m=t(4),f=function(e){return r.a.createElement("div",{className:"container-fluid ".concat(e.className)},e.children)},b=t(16),h=Object(a.forwardRef)((function(e,n){console.log("props",e);var t=e.label,a=e.containerClass,c=(e.innerRef,Object(b.a)(e,["label","containerClass","innerRef"]));return(r.a.createElement("div",{className:a},r.a.createElement("label",null,t),r.a.createElement("div",{className:"input-group"},r.a.createElement("input",Object.assign({ref:n,className:"form-control"},c)))))})),v=function(e){e.children;var n=Object(b.a)(e,["children"]);return(r.a.createElement("button",n,e.children))},p=function(e){var n=e.brandName,t=void 0===n?"":n;return r.a.createElement("nav",{className:"navbar navbar-dark bg-dark"},t&&r.a.createElement("div",{className:"navbar-brand",onClick:function(){e.onBrandPress&&e.onBrandPress()}},e.brandName),e.children)},O=t(25),g=t.n(O)()({LOGIN_REQUEST_SUCCESS:null,LOGOUT:null}),E=function(e){return function(n){var t;n((t={name:e},{type:g.LOGIN_REQUEST_SUCCESS,payload:t}))}},j=function(){return function(e){e({type:g.LOGOUT})}},N=function(){var e=Object(l.b)(),n=Object(a.useRef)(),t=Object(a.useRef)(),c=Object(a.useState)(null),o=Object(m.a)(c,2),s=o[0],i=o[1],b=function(){var n=Object(d.a)(u.a.mark((function n(t,a){var r,c;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(t+a);case 2:return r=n.sent,n.next=5,r.json();case 5:if("Unauthorized"!==(c=n.sent).userName){n.next=10;break}return console.log("Unauthorized user"),i("user not found !"),n.abrupt("return");case 10:c.userName===a&&(console.log("Aauthorized user : "+a),e(E(a)));case 11:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(p,{brandName:"Login to chat room"}),r.a.createElement(f,{className:"p-4"},r.a.createElement("h1",null,s),r.a.createElement(h,{ref:n,label:"Name",containerClass:"mb-3",placeholder:"Enter name"}),r.a.createElement("ol",null," ",r.a.createElement("b",null,"UserName Eamples"),r.a.createElement("li",null,"sanjai"),r.a.createElement("li",null,"navin")),r.a.createElement(h,{ref:t,label:"ServerUrl",containerClass:"mb-3",placeholder:"Enter Server Url",value:"https://meet-v1.herokuapp.com/"}),r.a.createElement(v,{onClick:function(){if(t.current.value){var e=n.current.value;e&&b(t.current.value+"/user/authenticate/",e)}else console.log("enter the server url to proceed!")},className:"btn btn-primary"},"Login to room")))},C=(t(42),function(e){return r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header"},e.username),r.a.createElement("div",{className:"card-body"},r.a.createElement("video",{className:"video",ref:e.innerRef,autoPlay:!0,playsInline:!0})))}),k=Object(a.forwardRef)((function(e,n){return r.a.createElement(C,Object.assign({innerRef:n},e))})),S=t(10),w=t(11),y=t(12),R=t(14),I=t(15),U={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},T={optional:[{RtpDataChannels:!0}]},L=function(e){Object(y.a)(t,e);var n=Object(R.a)(t);function t(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(S.a)(this,t),(a=n.call(this,U,T)).onicecandidate=function(e){a.callState&&e.candidate&&a.ms.send({peerName:a.peerName,peerId:a.peerId,event:"candidate",data:e.candidate})},a.ms=e,a.peerName=r,a.peerId=c,a.configureDataChannel(),console.log(r+" peer started"),a}return Object(w.a)(t,[{key:"configureDataChannel",value:function(){this.dataChannel=this.createDataChannel("dataChannel",{reliable:!0}),this.dataChannel.onerror=function(e){console.log("Error occured on datachannel:",e)},this.dataChannel.onmessage=function(e){console.log("message:",e)},this.dataChannel.onclose=function(){console.log("data channel is closed")},this.callState=!1}},{key:"setUserName",value:function(e){this.peerName=e}},{key:"sendMessage",value:function(e){console.log("Messaging via data channel"),this.dataChannel.send(JSON.stringify(e))}},{key:"sendOffer",value:function(){var e=this;this.createOffer().then((function(n){e.setLocalDescription(n),e.ms.send({peerName:e.peerName,peerId:e.peerId,event:"offer",data:n})})).catch((function(n){return e.onError(n)}))}},{key:"handleOffer",value:function(e){var n=this;this.setRemoteDescription(e),this.createAnswer().then((function(e){n.setLocalDescription(e),n.ms.send({peerName:n.peerName,peerId:n.peerId,event:"answer",data:e})})).catch((function(e){return n.onError(e)}))}},{key:"handleCandidate",value:function(e){this.addIceCandidate(new RTCIceCandidate(e)),console.log("Candidate received")}},{key:"handleAnswer",value:function(e){this.setRemoteDescription(new RTCSessionDescription(e)),this.callState=!0,console.log("connection established successfully!!")}},{key:"onError",value:function(e){console.error(e)}}]),t}(Object(I.a)(RTCPeerConnection)),D=t(8),x=t(28),M=t(3),_=function(e,n){console.log("received a ping from "+e.peerName+" with the message "+e.data.message)},G=function(e,n){console.log("received offer"),n.mp.handleOffer(e.data)},J=function(e,n){console.log("received iceCandidate"),n.mp.handleCandidate(e)},P=function(e,n){console.log("received answer"),n.mp.handleAnswer(e)},V=function(e,n){var t=JSON.parse(e.data),a=t.data;switch(t.event){case"offer":G(t,n);break;case"answer":P(a,n);break;case"candidate":J(a,n);break;case"ping":_(t,n)}},A=function(e){Object(y.a)(t,e);var n=Object(R.a)(t);function t(e){var a,r,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(S.a)(this,t);var s=function(e){return e?e?"wss://":"ws://":""},i=function(e){return e?":"+e:""},u=function(e){return o?"/"+e:"/"},d=s(c)+e+i(l)+u(o);return(r=n.call(this,d)).onopen=function(){console.log("Connected to the signaling server at "+r.url),r.send({peerName:r.userName,peerId:r.id,event:"ping",data:{message:"hello"}})},r.onmessage=function(e){V(e,Object(D.a)(r))},r.send=function(e){r.readyState===r.OPEN?Object(x.a)((a=Object(D.a)(r),Object(M.a)(t.prototype)),"send",a).call(a,JSON.stringify(e)):console.log("can't send message : "+e)},r.onclose=function(){console.log("closing")},r.id=Math.floor(2*Math.random())+1,r}return Object(w.a)(t,[{key:"addMp",value:function(e){this.mp=e}}]),t}(Object(I.a)(WebSocket)),B=function(e){var n=Object(a.useState)(null),t=Object(m.a)(n,2),c=t[0],o=t[1],s=Object(a.useState)(null),i=Object(m.a)(s,2),u=i[0],d=i[1],f=Object(l.c)((function(e){return e.user.name})),b=Object(a.useRef)(null);return Object(a.useEffect)((function(){e.localVideo&&u&&e.localVideo.getTracks().forEach((function(n){return u.addTrack(n,e.localVideo)})),u&&(u.ontrack=function(e){b.current&&(b.current.srcObject=e.streams[0])})}),[e.localVideo,u]),Object(a.useEffect)((function(){if(null!==c){if(c&&null===u&&f){var n=new L(c,f);return d(n),void c.addMp(n)}e.live&&u&&u.sendOffer()}else{var t=new A("meet-v1.herokuapp.com",!0,"socket");o(t)}}),[e.live,f,c,u]),r.a.createElement(r.a.Fragment,null,e.live&&r.a.createElement(k,{ref:b,username:f}))},W=Object(a.forwardRef)((function(e,n){return r.a.createElement(B,Object.assign({localVideo:n},e))})),z={video:!0,audio:!0},F=function(){var e,n=Object(l.b)(),t=Object(a.useState)(!1),c=Object(m.a)(t,2),o=c[0],s=c[1],i=Object(a.useState)(!1),b=Object(m.a)(i,2),h=b[0],O=b[1],g=Object(l.c)((function(e){return e.user.name})),E=Object(a.useRef)(null),N=Object(a.useState)(null),C=Object(m.a)(N,2),S=C[0],w=C[1],y=function(){var n=Object(d.a)(u.a.mark((function n(){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,s(!0),n.next=4,navigator.mediaDevices.getUserMedia(z);case 4:e=n.sent,E.current.srcObject=e,w(e),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),s(!1);case 12:case"end":return n.stop()}}),n,null,[[0,9]])})));return function(){return n.apply(this,arguments)}}();return Object(a.useEffect)((function(){y()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(p,{brandName:"Realtime Communcation with WebRTC"},r.a.createElement("ul",{className:"navbar-nav ml-auto"},r.a.createElement("li",{className:"nav-item"},r.a.createElement("button",{className:"btn btn-primary",onClick:function(){n(j())}},"Logout")))),r.a.createElement(f,{className:"p-4"},!1,r.a.createElement(v,{onClick:function(){O(!h)},className:"btn btn-primary mb-4"},h?"Stop Offer":"Start Offer"),o&&r.a.createElement(k,{ref:E,username:g}),o&&r.a.createElement(W,{live:h,ref:S})))},Q=function(){return Object(l.c)((function(e){return e.user.loggedIn}))?r.a.createElement(F,null):r.a.createElement(N,null)},$=t(1),q=t(20),H=t(26),K=t.n(H),X=t(27),Y=t(21),Z={name:"",loggedIn:!1},ee=Object($.c)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case g.LOGIN_REQUEST_SUCCESS:return Object(Y.a)(Object(Y.a)({},e),{},{name:n.payload.name,loggedIn:!0});case g.LOGOUT:return Z;default:return e}}}),ne={key:"meet_root_storage",storage:K.a},te=Object(q.a)(ne,ee),ae=Object($.d)(te,Object($.a)(X.a)),re=Object(q.b)(ae);var ce=function(){return r.a.createElement(l.a,{store:ae},r.a.createElement(s.a,{loading:null,persistor:re},r.a.createElement(Q,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ce,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[29,1,2]]]);
//# sourceMappingURL=main.2c3a37b2.chunk.js.map